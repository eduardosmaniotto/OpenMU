@using System.ComponentModel.DataAnnotations
@using MUnique.OpenMU.Web.Shared.Services
@code {

    /// <summary>
    /// Gets or sets the caption of the breadcrumb.
    /// </summary>
    [Parameter]
    [Required]
    public string Caption { get; set; } = string.Empty;

    /// <summary>
    /// Gets or sets a flag indicating whether this breadcrumb
    /// should act as a new start of the history.
    /// </summary>
    [Parameter]
    public bool IsFirstFromRoot { get; set; }

    [Inject]
    private NavigationHistory NavigationHistory { get; set;  } = null!;

    private string? _lastUri;

    /// <inheritdoc />
    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        var currentUri = this.NavigationHistory.NavigationManager.Uri;
        if (this._lastUri == currentUri)
        {
            return;
        }

        this._lastUri = currentUri;
        if (this.IsFirstFromRoot)
        {
            this.NavigationHistory.Clear();
        }

        this.NavigationHistory.AddCurrentPageToHistory(this.Caption);
    }
}
